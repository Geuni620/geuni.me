---
date: "2025-06-15"
title: "í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ê¸°ë¡"
category: ["ê°œë°œ"]
summary: "ì‘ì„±í•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ì½”ë“œ, ê¸°ë¡í•´ë‘ê¸°"
---

## í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ë¡œê·¸ ì¶œë ¥í•˜ê¸°

```jsx
it("ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ ëœ í›„ debug ì¶œë ¥í•˜ê¸°", async () => {
  await render(<EmptyNotice />);

  // DOM êµ¬ì¡° ì¶œë ¥
  screen.debug();
});
```

`jsdom`ì— ì»´í¬ë„ŒíŠ¸ê°€ ì–´ë–»ê²Œ ë Œë”ë§ ë˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŒ

![elementë¥¼ ì¶œë ¥í•´ë³¼ ìˆ˜ ìˆìŒ](./screen-debug.png)

---

## ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ëª¨í‚¹í•˜ê¸°

ë‹¤ìŒê³¼ ê°™ì€ ì»´í¬ë„ŒíŠ¸ê°€ ìˆë‹¤.

```jsx
import { useNavigate } from "react-router-dom";

const EmptyNotice = () => {
  // here!!! ğŸ™‹â€â™‚ï¸
  const navigate = useNavigate();
  const handleClickBack = () => {
    navigate("/");
  };

  return (
   //..
  );
};
```

í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ëŠ” `react-router-dom` íŒ¨í‚¤ì§€ì— ì˜ì¡´í•˜ê³  ìˆë‹¤.

```jsx
import { useNavigate } from "react-router-dom";

const navigateFn = useNavigate();

it('"í™ˆìœ¼ë¡œ ê°€ê¸°" ë§í¬ë¥¼ í´ë¦­í• ê²½ìš° "/"ê²½ë¡œë¡œ navigate í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤', async () => {
  const { user } = await render(<EmptyNotice />);

  await user.click(screen.getByText("í™ˆìœ¼ë¡œ ê°€ê¸°"));
  expect(navigateFn).toHaveBeenCalledWith("/");
});
```

ìœ„ í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì‹¤í–‰í•˜ë©´ ì‹¤íŒ¨í•œë‹¤.  
`useNavigate` í›…ì´ `Router context` ì—†ì´ ë™ì‘í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

![useNavigate í›…ì´ Router context ì—†ì´ ë™ì‘í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì‹¤íŒ¨í•œë‹¤.](./navigate-error.png)

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ `navigate` í•¨ìˆ˜ë¥¼ ëª¨í‚¹í•´ì•¼í•œë‹¤.

```jsx
// ì‹¤ì œ ëª¨ë“ˆì„ ëª¨í‚¹í•œ ëª¨ë“ˆë¡œ ëŒ€ì²´í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì§„í–‰
// useNavigate í›…ìœ¼ë¡œ ë°˜í™˜ë°›ì€ navigate í•¨ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ í˜¸ì¶œë˜ì—ˆëŠ”ê°€? â†’ ìŠ¤íŒŒì´ í•¨ìˆ˜
const navigateFn = vi.fn();

vi.mock("react-router-dom", async () => {
  const original = await vi.importActual("react-router-dom");

  return { ...original, useNavigate: () => navigateFn };
});

it('"í™ˆìœ¼ë¡œ ê°€ê¸°" ë§í¬ë¥¼ í´ë¦­í• ê²½ìš° "/"ê²½ë¡œë¡œ navigateí•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤', async () => {
  const { user } = await render(<EmptyNotice />);

  await user.click(screen.getByText("í™ˆìœ¼ë¡œ ê°€ê¸°"));
  expect(navigateFn).toHaveBeenNthCalledWith(1, "/");
});
```

[vi.mock](https://vitest.dev/api/vi.html#vi-mock)ì€ ëª¨ë“ˆì„ ë¶€ë¶„ì ìœ¼ë¡œ ë˜ëŠ” ì „ì²´ì ìœ¼ë¡œ ëª¨í‚¹í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.  
[vi.importActual](https://vitest.dev/api/vi.html#vi-importactual)ëŠ” ì‹¤ì œ ëª¨ë“ˆì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¨ë‹¤.

ì¦‰, react-router-dom íŒ¨í‚¤ì§€ë¥¼ ëª¨í‚¹í•œ ë’¤, useNavigateë¥¼ navigateFn í•¨ìˆ˜ë¡œ ëŒ€ì²´í•œë‹¤.

ì—¬ê¸°ì„œ navigateFnì€ spy(ì´í•˜ ìŠ¤íŒŒì´) í•¨ìˆ˜ì´ë‹¤. ìŠ¤íŒŒì´ í•¨ìˆ˜ë€ íŠ¹ì • í•¨ìˆ˜ì˜ í˜¸ì¶œ ì—¬ë¶€/ì¸ì ë“±ì„ ì¶”ì  ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” í•¨ìˆ˜ì´ë‹¤.

---

## setup, teardown í•¨ìˆ˜

---

## useCustomHook í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±í•˜ê¸°

ë‹¤ìŒê³¼ ê°™ì€ í›…(hooks)ì´ ìˆë‹¤.  
ì¼ë°˜ì ìœ¼ë¡œ ëª¨ë‹¬ì„ ì—´ê³ , ë‹«ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” í›…ì´ë‹¤.

```jsx
import { useState } from "react";

const useConfirmModal = (initialValue = false) => {
  const [isModalOpened, setIsModalOpened] = useState(initialValue);

  const toggleIsModalOpened = () => {
    setIsModalOpened(!isModalOpened);
  };

  return {
    toggleIsModalOpened,
    isModalOpened,
  };
};
```

ì´ í›…ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ì.

```jsx
import { renderHook, act } from "@testing-library/react";
import useConfirmModal from "./useConfirmModal";

it("í˜¸ì¶œ ì‹œ initialValue ì¸ìë¥¼ ì§€ì •í•˜ì§€ ì•ŠëŠ” ê²½ìš° isModalOpened ìƒíƒœê°€ falseë¡œ ì„¤ì •ëœë‹¤.", () => {
  // result: í›…ì„ í˜¸ì¶œí•˜ì—¬ ì–»ì€ ê²°ê³¼ ê°’ì„ ë°˜í™˜ â†’ result.current ê°’ì˜ ì°¸ì¡°ë¥¼ í†µí•´ ìµœì‹  ìƒíƒœë¥¼ ì¶”ì í•  ìˆ˜ ìˆë‹¤.
  // rerender: í›…ì„ ì›í•˜ëŠ” ì¸ìì™€ í•¨ê»˜ ìƒˆë¡œ í˜¸ì¶œí•˜ì—¬ ìƒíƒœë¥¼ ê°±ì‹ í•œë‹¤.
  const { result } = renderHook(useConfirmModal);

  expect(result.current.isModalOpened).toBe(false);
});

it("í˜¸ì¶œ ì‹œ initialValue ì¸ìë¥¼ boolean ê°’ìœ¼ë¡œ ì§€ì •í•˜ëŠ” ê²½ìš° í•´ë‹¹ ê°’ìœ¼ë¡œ isModalOpened ìƒíƒœê°€ ì„¤ì •ëœë‹¤.", () => {
  const { result } = renderHook(() => useConfirmModal(true));

  expect(result.current.isModalOpened).toBe(true);
});

it("í›…ì˜ toggleIsModalOpened()ë¥¼ í˜¸ì¶œí•˜ë©´ isModalOpened ìƒíƒœê°€ toggleëœë‹¤.", () => {
  const { result } = renderHook(useConfirmModal);

  act(() => result.current.toggleIsModalOpened());

  expect(result.current.isModalOpened).toBe(true);
});
```

[`renderHook`](https://testing-library.com/docs/react-testing-library/api#renderhook)í•¨ìˆ˜ì™€, [`act`](https://testing-library.com/docs/react-testing-library/api#act)í•¨ìˆ˜ê°€ ëˆˆì— ëˆë‹¤. ê°ê° ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ê±¸ê¹Œ?

<br />

`renderHook` í•¨ìˆ˜ëŠ” í›…ì„ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ë Œë”ë§ í•  ìˆ˜ ìˆë‹¤.

```jsx
const { result, rerender } = renderHook(useConfirmModal);
```

`renderHook`í•¨ìˆ˜ëŠ” resultì™€ rerenderë¥¼ ë°˜í™˜í•˜ëŠ”ë°, resultì˜ current ê°’ì„ í†µí•´ í›…ì˜ ìƒíƒœë¥¼ ì¶”ì í•  ìˆ˜ ìˆë‹¤.

```jsx
const { result } = renderHook(useConfirmModal);

console.log(result.current); // { isModalOpened: false }

expect(result.current.isModalOpened).toBe(false);
```

<br />

`act`í•¨ìˆ˜ëŠ” í›…ì˜ ìƒíƒœë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆë‹¤.  
ì°¸ê³ ë¡œ `act`í•¨ìˆ˜ëŠ” `testing-library/react`íŒ¨í‚¤ì§€ì—ì„œ ì œê³µí•´ì£¼ê¸°ë„ í•˜ì§€ë§Œ, [react íŒ¨í‚¤ì§€](https://react.dev/reference/react/act)ì—ì„œë„ ì œê³µí•´ì£¼ê³  ìˆë‹¤.

> reactì—ì„œ ì œê³µí•´ì£¼ëŠ” actë¥¼ ì‚¬ìš©í•  ì‹œ, ì¨ì•¼í•  ì½”ë“œê°€ ë§ì•„ì§ˆ ìˆ˜ ìˆì–´ì„œ, testing-libraryì—ì„œ ì œê³µí•´ì£¼ëŠ” actë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

```jsx
// default false
const { result } = renderHook(useConfirmModal);

// í›…ì˜ ìƒíƒœë¥¼ ê°±ì‹ 
// actë¡œ ê°ì‹¸ì§€ ì•ŠëŠ”ë‹¤ë©´, í›…ì˜ ìƒíƒœê°€ ê°±ì‹ ë˜ì§€ ì•ŠëŠ”ë‹¤.
act(() => result.current.toggleIsModalOpened());

// í›…ì˜ ìƒíƒœê°€ ê°±ì‹ ë˜ì—ˆëŠ”ì§€ í™•ì¸
expect(result.current.isModalOpened).toBe(true);
```

---

## íƒ€ì´ë¨¸í…ŒìŠ¤íŠ¸

debounce í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì.

```jsx
export const debounce = (fn, wait) => {
  let timeout = null;

  return (...args) => {
    const later = () => {
      timeout = -1;
      fn(...args);
    };

    if (timeout) {
      clearTimeout(timeout);
    }
    timeout = window.setTimeout(later, wait);
  };
};
```

```jsx
it("íŠ¹ì • ì‹œê°„ì´ ì§€ë‚œ í›„ í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤.", () => {
  const spy = vi.fn();
  const deboundedFn = debounce(spy, 300);

  deboundedFn();

  expect(spy).toHaveBeenCalled();
});
```

ìœ„ì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•œë‹¤.

í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ë¹„ë™ê¸° íƒ€ì´ë¨¸ì™€ ë¬´ê´€í•˜ê²Œ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ë‹¨ì–¸ì´ ì‹¤í–‰ë˜ì–´ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•œë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, vitestì—ì„œëŠ” íƒ€ì´ë¨¸ë¥¼ ëª¨í‚¹í•  ìˆ˜ ìˆëŠ” APIë¥¼ ì œê³µí•œë‹¤.

- [vi.useFakeTimers](https://vitest.dev/api/vi.html#vi-usefaketimers)

useFakeTimersë¥¼ ì‚¬ìš©í•˜ë©´, í…ŒìŠ¤íŠ¸ì½”ë“œê°€ ì‘ì„±í•˜ëŠ” ì‹œì ì— íƒ€ì´ë¨¸ë¥¼ ëª¨í‚¹í•  ìˆ˜ ìˆë‹¤.

```jsx
beforeEach(() => {
  // í…ŒìŠ¤íŠ¸ ì „ íƒ€ì´ë¨¸ ëª¨í‚¹
  vi.useFakeTimers();
});

afterEach(() => {
  // í…ŒìŠ¤íŠ¸ í›„ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
  vi.useRealTimers();
});

it("íŠ¹ì • ì‹œê°„ì´ ì§€ë‚œ í›„ í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤.", () => {
  vi.useFakeTimers();

  const spy = vi.fn();
  const deboundedFn = debounce(spy, 300);

  deboundedFn();

  // 0.3s í›„  í•¨ìˆ˜ê°€ í˜¸ì¶œëœë‹¤.
  vi.advanceTimersByTime(300);
  expect(spy).toHaveBeenCalled();
});
```

ë§Œì•½ íŠ¹ì • ì‹œê°„ì„ ì¡°ì‘í•´ì•¼í•œë‹¤ë©´, [vi.setSystemTime](https://vitest.dev/api/vi.html#vi-setsystemtime)ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```jsx
it("2023ë…„ 12ì›” 25ì¼ ê¸°ì¤€, ...", () => {
  vi.useFakeTimers();
  // íŠ¹ì • ì‹œê°„ì„ ì¡°ì‘, 2023ë…„ 12ì›” 25ì¼
  vi.setSystemTime(new Date("2023-12-25"));
  //...
});
```

ì¶”ê°€ë¡œ í•´ë‹¹ ìŠ¤ì½”í”„ ë‚´ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ê³  ë‚œ ë’¤, ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸í™˜ê²½ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ í•˜ê¸° ìœ„í•´ teardown í•¨ìˆ˜ë¥¼ ì´ìš©í•´ íƒ€ì´ë¨¸ ì„¤ì •ì„ ì´ˆê¸°í™” ì‹œì¼œì¤˜ì•¼í•œë‹¤.

```jsx
afterEach(() => {
  // í…ŒìŠ¤íŠ¸ í›„ íƒ€ì´ë¨¸ ì´ˆê¸°í™”
  vi.useRealTimers();
});
```

---

## userEvent vs fireEvent

---

<br />

## ì°¸ê³ ìë£Œ

[vitest discussions #5809: Mocking imported modules correctly with Vitest and React](https://github.com/vitest-dev/vitest/discussions/5809)
