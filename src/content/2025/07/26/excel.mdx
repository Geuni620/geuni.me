---
date: "2025-07-26"
title: ""
category: ["개발"]
summary: ""
---

A페이지에서 보여지는 데이터를 엑셀로 다운받으려 할 때, 서버에서 처리시간이 길어져 사용자가 이를 기다리지 못하고 B페이지를 이탈했다고 가정해보자.  
B페이지에서 조회된 데이터를 확인하고 있는데, 요청보냈던 A페이지의 응답이 도착해서 엑셀파일을 브라우저를 통해 다운받을 수 있을까?

## 예시만들기

### Case 1

Next.js를 이용해서 간단한 예시를 만들어봤다.  
테스트는 다음과 같이 진행했다.

1. index페이지에서 'Excel 파일 다운로드 버튼 클릭'
   - 이때 응답은 최소 5초 이후에 받도록 setTimeout을 적용했다.
2. About 버튼을 클릭해서 About 페이지로 이동
   - 5초 전에 페이지를 이동시켰다.
3. 이동한 페이지에서 대기

![](./download.gif)

페이지를 이탈하더라도 response에 대한 응답이 도착하며, 다운로드가 가능한 것을 확인할 수 있다.

---

### Case 2

위 예시는 **같은 도메인이 유지**되었을 때의 경우다.  
만약, A페이지에서 B페이지로 이동할 때, B페이지가 다른 도메인이라면 어떻게 될까?

1. index페이지에서 'Excel 파일 다운로드 버튼 클릭'
2. Gmail로 도메인이 다른 페이지로 이동
3. 이동한 페이지에서 대기

![](./unknown.png)

개발자도구를 확인했을 때, `unknown`이 떠버린다.

---

### Case 3

만약 '새로고침(reload)' 시켰다면 어떻게 될까?

1. index페이지에서 'Excel 파일 다운로드 버튼 클릭'
2. 페이지 새로고침
3. 대기

![](./canceled.png)

개발자도구를 확인했을 때, `canceled`가 떠버린다.

## Fetch API, Request.keepalive

`case 1`에서 다운로드가 유지된 이유는 무엇일까?  
Fetch API 내 Request.keepalive 속성이 존재한다.

브라우저는 기본적으로 페이지 닫기, 새로고침, 이동 중인 경우 네트워크 요청을 중단한다.  
`keepalive: true`를 설정하면 브라우저에게 페이지가 언로드되어도 요청을 보내라고 지시하는 것과 같다.

한번 테스트해보자.

```tsx

```

## HTTP 비연결성

## HTTP header keep-alive

## 참고자료

[](https://css-tricks.com/send-an-http-request-on-page-exit/)  
[Request: keepalive property](https://developer.mozilla.org/en-US/docs/Web/API/Request/keepalive)
